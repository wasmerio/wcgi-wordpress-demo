function serialize(t){var e,n,i,o="",r=0;switch(_getType=function(t){var e,n,i,o,r=typeof t;if("object"===r&&!t)return"null";if("object"===r){if(!t.constructor)return"object";(e=(i=t.constructor.toString()).match(/(\w+)\(/))&&(i=e[1].toLowerCase()),o=["boolean","number","string","array"];for(n in o)if(i==o[n]){r=o[n];break}}return r},type=_getType(t),type){case"function":e="";break;case"boolean":e="b:"+(t?"1":"0");break;case"number":e=(Math.round(t)==t?"i":"d")+":"+t;break;case"string":e="s:"+function(t){var e=0,n=0,i=t.length,o="";for(n=0;n<i;n++)e+=(o=t.charCodeAt(n))<128?1:o<2048?2:3;return e}(t)+':"'+t+'"';break;case"array":case"object":e="a";for(n in t)if(t.hasOwnProperty(n)){if("function"===_getType(t[n]))continue;i=n.match(/^[0-9]+$/)?parseInt(n,10):n,o+=this.serialize(i)+this.serialize(t[n]),r++}e+=":"+r+":{"+o+"}";break;case"undefined":default:e="N"}return"object"!==type&&"array"!==type&&("string"==type&&-1!=e.indexOf("}")||(e+=";")),e}function unserialize(t){var e=this;return error=function(t,n,i,o){throw new e.window[t](n,i,o)},read_until=function(t,e,n){for(var i=2,o=[],r=t.slice(e,e+1);r!=n;)i+e>t.length&&error("Error","Invalid"),o.push(r),r=t.slice(e+(i-1),e+i),i+=1;return[o.length,o.join("")]},read_chrs=function(t,e,n){var i,o,r,s;for(r=[],i=0;i<n;i++)o=t.slice(e+(i-1),e+i),r.push(o),n-=(void 0,(s=o.charCodeAt(0))<128?0:s<2048?1:2);return[r.length,r.join("")]},_unserialize=function(t,e){var n,i,o,r,s,a,l,p,c,u,d,h,g,f,v,m,y,w,C=0,b=function(t){return t};switch(e||(e=0),i=e+2,n=t.slice(e,e+1).toLowerCase()){case"i":b=function(t){return parseInt(t,10)},C=(c=read_until(t,i,";"))[0],p=c[1],i+=C+1;break;case"b":b=function(t){return 0!==parseInt(t,10)},C=(c=read_until(t,i,";"))[0],p=c[1],i+=C+1;break;case"d":b=function(t){return parseFloat(t)},C=(c=read_until(t,i,";"))[0],p=c[1],i+=C+1;break;case"n":p=null;break;case"s":C=(u=read_until(t,i,":"))[0],d=u[1],i+=C+2,C=(c=read_chrs(t,i+1,parseInt(d,10)))[0],p=c[1],i+=C+2,C!=parseInt(d,10)&&C!=p.length&&error("SyntaxError","String length mismatch");break;case"a":for(p={},C=(o=read_until(t,i,":"))[0],r=o[1],i+=C+2,a=parseInt(r,10),s=!0,h=0;h<a;h++)v=(f=_unserialize(t,i))[1],g=f[2],i+=v,y=(m=_unserialize(t,i))[1],w=m[2],i+=y,g!==h&&(s=!1),p[g]=w;if(s){for(l=new Array(a),h=0;h<a;h++)l[h]=p[h];p=l}i+=1;break;default:error("SyntaxError","Unknown / Unhandled data type(s): "+n)}return[n,i-e,b(p)]},_unserialize(t+"",0)[2]}!function(t,e){"function"==typeof define&&define.amd?define("sifter",e):"object"==typeof exports?module.exports=e():t.Sifter=e()}(this,function(){var t=function(t,e){this.items=t,this.settings=e||{diacritics:!0}};t.prototype.tokenize=function(t){if(!(t=i(String(t||"").toLowerCase()))||!t.length)return[];var e,n,r,a,l=[],p=t.split(/ +/);for(e=0,n=p.length;e<n;e++){if(r=o(p[e]),this.settings.diacritics)for(a in s)s.hasOwnProperty(a)&&(r=r.replace(new RegExp(a,"g"),s[a]));l.push({string:p[e],regex:new RegExp(r,"i")})}return l},t.prototype.iterator=function(t,e){(r(t)?Array.prototype.forEach||function(t){for(var e=0,n=this.length;e<n;e++)t(this[e],e,this)}:function(t){for(var e in this)this.hasOwnProperty(e)&&t(this[e],e,this)}).apply(t,[e])},t.prototype.getScoreFunction=function(t,e){var n,i,o;t=this.prepareSearch(t,e),i=t.tokens,n=t.options.fields,o=i.length;var r,s=function(t,e){var n,i;return t?-1===(i=(t=String(t||"")).search(e.regex))?0:(n=e.string.length/t.length,0===i&&(n+=.5),n):0},a=(r=n.length)?1===r?function(t,e){return s(e[n[0]],t)}:function(t,e){for(var i=0,o=0;i<r;i++)o+=s(e[n[i]],t);return o/r}:function(){return 0};return o?1===o?function(t){return a(i[0],t)}:"and"===t.options.conjunction?function(t){for(var e,n=0,r=0;n<o;n++){if((e=a(i[n],t))<=0)return 0;r+=e}return r/o}:function(t){for(var e=0,n=0;e<o;e++)n+=a(i[e],t);return n/o}:function(){return 0}},t.prototype.getSortFunction=function(t,n){var i,o,r,s,a,l,p,c,u,d,h;if(h=!(t=(r=this).prepareSearch(t,n)).query&&n.sort_empty||n.sort,u=function(t,e){return"$score"===t?e.score:r.items[e.id][t]},a=[],h)for(i=0,o=h.length;i<o;i++)(t.query||"$score"!==h[i].field)&&a.push(h[i]);if(t.query){for(d=!0,i=0,o=a.length;i<o;i++)if("$score"===a[i].field){d=!1;break}d&&a.unshift({field:"$score",direction:"desc"})}else for(i=0,o=a.length;i<o;i++)if("$score"===a[i].field){a.splice(i,1);break}for(c=[],i=0,o=a.length;i<o;i++)c.push("desc"===a[i].direction?-1:1);return(l=a.length)?1===l?(s=a[0].field,p=c[0],function(t,n){return p*e(u(s,t),u(s,n))}):function(t,n){var i,o,r;for(i=0;i<l;i++)if(r=a[i].field,o=c[i]*e(u(r,t),u(r,n)))return o;return 0}:null},t.prototype.prepareSearch=function(t,e){if("object"==typeof t)return t;var i=(e=n({},e)).fields,o=e.sort,s=e.sort_empty;return i&&!r(i)&&(e.fields=[i]),o&&!r(o)&&(e.sort=[o]),s&&!r(s)&&(e.sort_empty=[s]),{options:e,query:String(t||"").toLowerCase(),tokens:this.tokenize(t),total:0,items:[]}},t.prototype.search=function(t,e){var n,i,o,r,s=this;return i=this.prepareSearch(t,e),e=i.options,t=i.query,r=e.score||s.getScoreFunction(i),t.length?s.iterator(s.items,function(t,o){n=r(t),(!1===e.filter||n>0)&&i.items.push({score:n,id:o})}):s.iterator(s.items,function(t,e){i.items.push({score:1,id:e})}),(o=s.getSortFunction(i,e))&&i.items.sort(o),i.total=i.items.length,"number"==typeof e.limit&&(i.items=i.items.slice(0,e.limit)),i};var e=function(t,e){return"number"==typeof t&&"number"==typeof e?t>e?1:t<e?-1:0:(t=a(String(t||"")))>(e=a(String(e||"")))?1:e>t?-1:0},n=function(t,e){var n,i,o,r;for(n=1,i=arguments.length;n<i;n++)if(r=arguments[n])for(o in r)r.hasOwnProperty(o)&&(t[o]=r[o]);return t},i=function(t){return(t+"").replace(/^\s+|\s+$|/g,"")},o=function(t){return(t+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")},r=Array.isArray||"undefined"!=typeof $&&$.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},s={a:"[aÀÁÂÃÄÅàáâãäåĀāąĄ]",c:"[cÇçćĆčČ]",d:"[dđĐďĎð]",e:"[eÈÉÊËèéêëěĚĒēęĘ]",i:"[iÌÍÎÏìíîïĪī]",l:"[lłŁ]",n:"[nÑñňŇńŃ]",o:"[oÒÓÔÕÕÖØòóôõöøŌō]",r:"[rřŘ]",s:"[sŠšśŚ]",t:"[tťŤ]",u:"[uÙÚÛÜùúûüůŮŪū]",y:"[yŸÿýÝ]",z:"[zŽžżŻźŹ]"},a=function(){var t,e,n,i,o="",r={};for(n in s)if(s.hasOwnProperty(n))for(o+=i=s[n].substring(2,s[n].length-1),t=0,e=i.length;t<e;t++)r[i.charAt(t)]=n;var a=new RegExp("["+o+"]","g");return function(t){return t.replace(a,function(t){return r[t]}).toLowerCase()}}();return t}),function(t,e){"function"==typeof define&&define.amd?define("microplugin",e):"object"==typeof exports?module.exports=e():t.MicroPlugin=e()}(this,function(){var t={mixin:function(t){t.plugins={},t.prototype.initializePlugins=function(t){var n,i,o,r=[];if(this.plugins={names:[],settings:{},requested:{},loaded:{}},e.isArray(t))for(n=0,i=t.length;n<i;n++)"string"==typeof t[n]?r.push(t[n]):(this.plugins.settings[t[n].name]=t[n].options,r.push(t[n].name));else if(t)for(o in t)t.hasOwnProperty(o)&&(this.plugins.settings[o]=t[o],r.push(o));for(;r.length;)this.require(r.shift())},t.prototype.loadPlugin=function(e){var n=this.plugins,i=t.plugins[e];if(!t.plugins.hasOwnProperty(e))throw new Error('Unable to find "'+e+'" plugin');n.requested[e]=!0,n.loaded[e]=i.fn.apply(this,[this.plugins.settings[e]||{}]),n.names.push(e)},t.prototype.require=function(t){var e=this.plugins;if(!this.plugins.loaded.hasOwnProperty(t)){if(e.requested[t])throw new Error('Plugin has circular dependency ("'+t+'")');this.loadPlugin(t)}return e.loaded[t]},t.define=function(e,n){t.plugins[e]={name:e,fn:n}}}},e={isArray:Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)}};return t}),function(t,e){"function"==typeof define&&define.amd?define("selectize",["jquery","sifter","microplugin"],e):"object"==typeof exports?module.exports=e(require("jquery"),require("sifter"),require("microplugin")):t.Selectize=e(t.jQuery,t.Sifter,t.MicroPlugin)}(this,function(t,e,n){"use strict";var i=function(t,e){if("string"!=typeof e||e.length){var n="string"==typeof e?new RegExp(e,"i"):e,i=function(t){var e=0;if(3===t.nodeType){var o=t.data.search(n);if(o>=0&&t.data.length>0){var r=t.data.match(n),s=document.createElement("span");s.className="highlight";var a=t.splitText(o),l=(a.splitText(r[0].length),a.cloneNode(!0));s.appendChild(l),a.parentNode.replaceChild(s,a),e=1}}else if(1===t.nodeType&&t.childNodes&&!/(script|style)/i.test(t.tagName))for(var p=0;p<t.childNodes.length;++p)p+=i(t.childNodes[p]);return e};return t.each(function(){i(this)})}},o=function(){};o.prototype={on:function(t,e){this._events=this._events||{},this._events[t]=this._events[t]||[],this._events[t].push(e)},off:function(t,e){var n=arguments.length;return 0===n?delete this._events:1===n?delete this._events[t]:(this._events=this._events||{},void(t in this._events!=!1&&this._events[t].splice(this._events[t].indexOf(e),1)))},trigger:function(t){if(this._events=this._events||{},t in this._events!=!1)for(var e=0;e<this._events[t].length;e++)this._events[t][e].apply(this,Array.prototype.slice.call(arguments,1))}},o.mixin=function(t){for(var e=["on","off","trigger"],n=0;n<e.length;n++)t.prototype[e[n]]=o.prototype[e[n]]};var r=/Mac/.test(navigator.userAgent),s=r?91:17,a=r?18:17,l=!/android/i.test(window.navigator.userAgent)&&!!document.createElement("form").validity,p=function(t){return void 0!==t},c=function(t){return void 0===t||null===t?null:"boolean"==typeof t?t?"1":"0":t+""},u=function(t){return(t+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},d={before:function(t,e,n){var i=t[e];t[e]=function(){return n.apply(t,arguments),i.apply(t,arguments)}},after:function(t,e,n){var i=t[e];t[e]=function(){var e=i.apply(t,arguments);return n.apply(t,arguments),e}}},h=function(t,e,n){var i,o=t.trigger,r={};t.trigger=function(){var n=arguments[0];if(-1===e.indexOf(n))return o.apply(t,arguments);r[n]=arguments},n.apply(t,[]),t.trigger=o;for(i in r)r.hasOwnProperty(i)&&o.apply(t,r[i])},g=function(t){var e={};if("selectionStart"in t)e.start=t.selectionStart,e.length=t.selectionEnd-e.start;else if(document.selection){t.focus();var n=document.selection.createRange(),i=document.selection.createRange().text.length;n.moveStart("character",-t.value.length),e.start=n.text.length-i,e.length=i}return e},f=function(e){var n=null,i=function(i,o){var r,s,a,l,p,c,u,d;i=i||window.event||{},o=o||{},i.metaKey||i.altKey||(o.force||!1!==e.data("grow"))&&(r=e.val(),i.type&&"keydown"===i.type.toLowerCase()&&(a=(s=i.keyCode)>=97&&s<=122||s>=65&&s<=90||s>=48&&s<=57||32===s,46===s||8===s?(d=g(e[0])).length?r=r.substring(0,d.start)+r.substring(d.start+d.length):8===s&&d.start?r=r.substring(0,d.start-1)+r.substring(d.start+1):46===s&&void 0!==d.start&&(r=r.substring(0,d.start)+r.substring(d.start+1)):a&&(c=i.shiftKey,u=String.fromCharCode(i.keyCode),r+=u=c?u.toUpperCase():u.toLowerCase())),l=e.attr("placeholder"),!r&&l&&(r=l),(p=function(e,n){if(!e)return 0;var i=t("<test>").css({position:"absolute",top:-99999,left:-99999,width:"auto",padding:0,whiteSpace:"pre"}).text(e).appendTo("body");!function(t,e,n){var i,o,r={};if(n)for(i=0,o=n.length;i<o;i++)r[n[i]]=t.css(n[i]);else r=t.css();e.css(r)}(n,i,["letterSpacing","fontSize","fontFamily","fontWeight","textTransform"]);var o=i.width();return i.remove(),o}(r,e)+4)!==n&&(n=p,e.width(p),e.triggerHandler("resize")))};e.on("keydown keyup update blur",i),i()},v=function(n,i){var o,r,s,a,l=this;(a=n[0]).selectize=l;var p,c,u,d=window.getComputedStyle&&window.getComputedStyle(a,null);if(s=(s=d?d.getPropertyValue("direction"):a.currentStyle&&a.currentStyle.direction)||n.parents("[dir]:first").attr("dir")||"",t.extend(l,{order:0,settings:i,$input:n,tabIndex:n.attr("tabindex")||"",tagType:"select"===a.tagName.toLowerCase()?1:2,rtl:/rtl/i.test(s),eventNS:".selectize"+ ++v.count,highlightedValue:null,isOpen:!1,isDisabled:!1,isRequired:n.is("[required]"),isInvalid:!1,isLocked:!1,isFocused:!1,isInputHidden:!1,isSetup:!1,isShiftDown:!1,isCmdDown:!1,isCtrlDown:!1,ignoreFocus:!1,ignoreBlur:!1,ignoreHover:!1,hasOptions:!1,currentResults:null,lastValue:"",caretPos:0,loading:0,loadedSearches:{},$activeOption:null,$activeItems:[],optgroups:{},options:{},userOptions:{},items:[],renderCache:{},onSearchChange:null===i.loadThrottle?l.onSearchChange:(p=l.onSearchChange,c=i.loadThrottle,function(){var t=this,e=arguments;window.clearTimeout(u),u=window.setTimeout(function(){p.apply(t,e)},c)})}),l.sifter=new e(this.options,{diacritics:i.diacritics}),l.settings.options){for(o=0,r=l.settings.options.length;o<r;o++)l.registerOption(l.settings.options[o]);delete l.settings.options}if(l.settings.optgroups){for(o=0,r=l.settings.optgroups.length;o<r;o++)l.registerOptionGroup(l.settings.optgroups[o]);delete l.settings.optgroups}l.settings.mode=l.settings.mode||(1===l.settings.maxItems?"single":"multi"),"boolean"!=typeof l.settings.hideSelected&&(l.settings.hideSelected="multi"===l.settings.mode),l.initializePlugins(l.settings.plugins),l.setupCallbacks(),l.setupTemplates(),l.setup()};return o.mixin(v),n.mixin(v),t.extend(v.prototype,{setup:function(){var e,n,i,o,p,c,u,d,h,g,v,m,y,w=this,C=w.settings,b=w.eventNS,O=t(window),$=t(document),_=w.$input;if(u=w.settings.mode,d=_.attr("class")||"",e=t("<div>").addClass(C.wrapperClass).addClass(d).addClass(u),n=t("<div>").addClass(C.inputClass).addClass("items").appendTo(e),i=t('<input type="text" autocomplete="off" />').appendTo(n).attr("tabindex",_.is(":disabled")?"-1":w.tabIndex),c=t(C.dropdownParent||e),o=t("<div>").addClass(C.dropdownClass).addClass(u).hide().appendTo(c),p=t("<div>").addClass(C.dropdownContentClass).appendTo(o),w.settings.copyClassesToDropdown&&o.addClass(d),e.css({width:_[0].style.width}),w.plugins.names.length&&(h="plugin-"+w.plugins.names.join(" plugin-"),e.addClass(h),o.addClass(h)),(null===C.maxItems||C.maxItems>1)&&1===w.tagType&&_.attr("multiple","multiple"),w.settings.placeholder&&i.attr("placeholder",C.placeholder),!w.settings.splitOn&&w.settings.delimiter){var k=w.settings.delimiter.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&");w.settings.splitOn=new RegExp("\\s*"+k+"+\\s*")}_.attr("autocorrect")&&i.attr("autocorrect",_.attr("autocorrect")),_.attr("autocapitalize")&&i.attr("autocapitalize",_.attr("autocapitalize")),w.$wrapper=e,w.$control=n,w.$control_input=i,w.$dropdown=o,w.$dropdown_content=p,o.on("mouseenter","[data-selectable]",function(){return w.onOptionHover.apply(w,arguments)}),o.on("mousedown click","[data-selectable]",function(){return w.onOptionSelect.apply(w,arguments)}),v="mousedown",m="*:not(input)",y=function(){return w.onItemSelect.apply(w,arguments)},(g=n).on(v,m,function(t){for(var e=t.target;e&&e.parentNode!==g[0];)e=e.parentNode;return t.currentTarget=e,y.apply(this,[t])}),f(i),n.on({mousedown:function(){return w.onMouseDown.apply(w,arguments)},click:function(){return w.onClick.apply(w,arguments)}}),i.on({mousedown:function(t){t.stopPropagation()},keydown:function(){return w.onKeyDown.apply(w,arguments)},keyup:function(){return w.onKeyUp.apply(w,arguments)},keypress:function(){return w.onKeyPress.apply(w,arguments)},resize:function(){w.positionDropdown.apply(w,[])},blur:function(){return w.onBlur.apply(w,arguments)},focus:function(){return w.ignoreBlur=!1,w.onFocus.apply(w,arguments)},paste:function(){return w.onPaste.apply(w,arguments)}}),$.on("keydown"+b,function(t){w.isCmdDown=t[r?"metaKey":"ctrlKey"],w.isCtrlDown=t[r?"altKey":"ctrlKey"],w.isShiftDown=t.shiftKey}),$.on("keyup"+b,function(t){t.keyCode===a&&(w.isCtrlDown=!1),16===t.keyCode&&(w.isShiftDown=!1),t.keyCode===s&&(w.isCmdDown=!1)}),$.on("mousedown"+b,function(t){if(w.isFocused){if(t.target===w.$dropdown[0]||t.target.parentNode===w.$dropdown[0])return!1;w.$control.has(t.target).length||t.target===w.$control[0]||w.blur(t.target)}}),O.on(["scroll"+b,"resize"+b].join(" "),function(){w.isOpen&&w.positionDropdown.apply(w,arguments)}),O.on("mousemove"+b,function(){w.ignoreHover=!1}),this.revertSettings={$children:_.children().detach(),tabindex:_.attr("tabindex")},_.attr("tabindex",-1).hide().after(w.$wrapper),t.isArray(C.items)&&(w.setValue(C.items),delete C.items),l&&_.on("invalid"+b,function(t){t.preventDefault(),w.isInvalid=!0,w.refreshState()}),w.updateOriginalInput(),w.refreshItems(),w.refreshState(),w.updatePlaceholder(),w.isSetup=!0,_.is(":disabled")&&w.disable(),w.on("change",this.onChange),_.data("selectize",w),_.addClass("selectized"),w.trigger("initialize"),!0===C.preload&&w.onSearchChange("")},setupTemplates:function(){var e=this.settings.labelField,n=this.settings.optgroupLabelField,i={optgroup:function(t){return'<div class="optgroup">'+t.html+"</div>"},optgroup_header:function(t,e){return'<div class="optgroup-header">'+e(t[n])+"</div>"},option:function(t,n){return'<div class="option">'+n(t[e])+"</div>"},item:function(t,n){return'<div class="item">'+n(t[e])+"</div>"},option_create:function(t,e){return'<div class="create">Add <strong>'+e(t.input)+"</strong>&hellip;</div>"}};this.settings.render=t.extend({},i,this.settings.render)},setupCallbacks:function(){var t,e,n={initialize:"onInitialize",change:"onChange",item_add:"onItemAdd",item_remove:"onItemRemove",clear:"onClear",option_add:"onOptionAdd",option_remove:"onOptionRemove",option_clear:"onOptionClear",optgroup_add:"onOptionGroupAdd",optgroup_remove:"onOptionGroupRemove",optgroup_clear:"onOptionGroupClear",dropdown_open:"onDropdownOpen",dropdown_close:"onDropdownClose",type:"onType",load:"onLoad",focus:"onFocus",blur:"onBlur"};for(t in n)n.hasOwnProperty(t)&&(e=this.settings[n[t]])&&this.on(t,e)},onClick:function(t){this.isFocused||(this.focus(),t.preventDefault())},onMouseDown:function(e){var n=this,i=e.isDefaultPrevented();t(e.target);if(n.isFocused){if(e.target!==n.$control_input[0])return"single"===n.settings.mode?n.isOpen?n.close():n.open():i||n.setActiveItem(null),!1}else i||window.setTimeout(function(){n.focus()},0)},onChange:function(){this.$input.trigger("change")},onPaste:function(e){var n=this;n.isFull()||n.isInputHidden||n.isLocked?e.preventDefault():n.settings.splitOn&&setTimeout(function(){for(var e=t.trim(n.$control_input.val()||"").split(n.settings.splitOn),i=0,o=e.length;i<o;i++)n.createItem(e[i])},0)},onKeyPress:function(t){if(this.isLocked)return t&&t.preventDefault();var e=String.fromCharCode(t.keyCode||t.which);return this.settings.create&&"multi"===this.settings.mode&&e===this.settings.delimiter?(this.createItem(),t.preventDefault(),!1):void 0},onKeyDown:function(t){t.target,this.$control_input[0];var e=this;if(e.isLocked)9!==t.keyCode&&t.preventDefault();else{switch(t.keyCode){case 65:if(e.isCmdDown)return void e.selectAll();break;case 27:return void(e.isOpen&&(t.preventDefault(),t.stopPropagation(),e.close()));case 78:if(!t.ctrlKey||t.altKey)break;case 40:if(!e.isOpen&&e.hasOptions)e.open();else if(e.$activeOption){e.ignoreHover=!0;var n=e.getAdjacentOption(e.$activeOption,1);n.length&&e.setActiveOption(n,!0,!0)}return void t.preventDefault();case 80:if(!t.ctrlKey||t.altKey)break;case 38:if(e.$activeOption){e.ignoreHover=!0;var i=e.getAdjacentOption(e.$activeOption,-1);i.length&&e.setActiveOption(i,!0,!0)}return void t.preventDefault();case 13:return void(e.isOpen&&e.$activeOption&&(e.onOptionSelect({currentTarget:e.$activeOption}),t.preventDefault()));case 37:return void e.advanceSelection(-1,t);case 39:return void e.advanceSelection(1,t);case 9:return e.settings.selectOnTab&&e.isOpen&&e.$activeOption&&(e.onOptionSelect({currentTarget:e.$activeOption}),e.isFull()||t.preventDefault()),void(e.settings.create&&e.createItem()&&t.preventDefault());case 8:case 46:return void e.deleteSelection(t)}!e.isFull()&&!e.isInputHidden||(r?t.metaKey:t.ctrlKey)||t.preventDefault()}},onKeyUp:function(t){var e=this;if(e.isLocked)return t&&t.preventDefault();var n=e.$control_input.val()||"";e.lastValue!==n&&(e.lastValue=n,e.onSearchChange(n),e.refreshOptions(),e.trigger("type",n))},onSearchChange:function(t){var e=this,n=e.settings.load;n&&(e.loadedSearches.hasOwnProperty(t)||(e.loadedSearches[t]=!0,e.load(function(i){n.apply(e,[t,i])})))},onFocus:function(t){var e=this,n=e.isFocused;if(e.isDisabled)return e.blur(),t&&t.preventDefault(),!1;e.ignoreFocus||(e.isFocused=!0,"focus"===e.settings.preload&&e.onSearchChange(""),n||e.trigger("focus"),e.$activeItems.length||(e.showInput(),e.setActiveItem(null),e.refreshOptions(!!e.settings.openOnFocus)),e.refreshState())},onBlur:function(t,e){var n=this;if(n.isFocused&&(n.isFocused=!1,!n.ignoreFocus)){if(!n.ignoreBlur&&document.activeElement===n.$dropdown_content[0])return n.ignoreBlur=!0,void n.onFocus(t);var i=function(){n.close(),n.setTextboxValue(""),n.setActiveItem(null),n.setActiveOption(null),n.setCaret(n.items.length),n.refreshState(),(e||document.body).focus(),n.ignoreFocus=!1,n.trigger("blur")};n.ignoreFocus=!0,n.settings.create&&n.settings.createOnBlur?n.createItem(null,!1,i):i()}},onOptionHover:function(t){this.ignoreHover||this.setActiveOption(t.currentTarget,!1)},onOptionSelect:function(e){var n,i,o=this;e.preventDefault&&(e.preventDefault(),e.stopPropagation()),(i=t(e.currentTarget)).hasClass("create")?o.createItem(null,function(){o.settings.closeAfterSelect&&o.close()}):void 0!==(n=i.attr("data-value"))&&(o.lastQuery=null,o.setTextboxValue(""),o.addItem(n),o.settings.closeAfterSelect?o.close():!o.settings.hideSelected&&e.type&&/mouse/.test(e.type)&&o.setActiveOption(o.getOption(n)))},onItemSelect:function(t){this.isLocked||"multi"===this.settings.mode&&(t.preventDefault(),this.setActiveItem(t.currentTarget,t))},load:function(t){var e=this,n=e.$wrapper.addClass(e.settings.loadingClass);e.loading++,t.apply(e,[function(t){e.loading=Math.max(e.loading-1,0),t&&t.length&&(e.addOption(t),e.refreshOptions(e.isFocused&&!e.isInputHidden)),e.loading||n.removeClass(e.settings.loadingClass),e.trigger("load",t)}])},setTextboxValue:function(t){var e=this.$control_input;e.val()!==t&&(e.val(t).triggerHandler("update"),this.lastValue=t)},getValue:function(){return 1===this.tagType&&this.$input.attr("multiple")?this.items:this.items.join(this.settings.delimiter)},setValue:function(t,e){h(this,e?[]:["change"],function(){this.clear(e),this.addItems(t,e)})},setActiveItem:function(e,n){var i,o,r,s,a,l,p,c,u=this;if("single"!==u.settings.mode){if(!(e=t(e)).length)return t(u.$activeItems).removeClass("active"),u.$activeItems=[],void(u.isFocused&&u.showInput());if("mousedown"===(i=n&&n.type.toLowerCase())&&u.isShiftDown&&u.$activeItems.length){for(c=u.$control.children(".active:last"),(s=Array.prototype.indexOf.apply(u.$control[0].childNodes,[c[0]]))>(a=Array.prototype.indexOf.apply(u.$control[0].childNodes,[e[0]]))&&(p=s,s=a,a=p),o=s;o<=a;o++)l=u.$control[0].childNodes[o],-1===u.$activeItems.indexOf(l)&&(t(l).addClass("active"),u.$activeItems.push(l));n.preventDefault()}else"mousedown"===i&&u.isCtrlDown||"keydown"===i&&this.isShiftDown?e.hasClass("active")?(r=u.$activeItems.indexOf(e[0]),u.$activeItems.splice(r,1),e.removeClass("active")):u.$activeItems.push(e.addClass("active")[0]):(t(u.$activeItems).removeClass("active"),u.$activeItems=[e.addClass("active")[0]]);u.hideInput(),this.isFocused||u.focus()}},setActiveOption:function(e,n,i){var o,r,s,a,l,c=this;c.$activeOption&&c.$activeOption.removeClass("active"),c.$activeOption=null,(e=t(e)).length&&(c.$activeOption=e.addClass("active"),!n&&p(n)||(o=c.$dropdown_content.height(),r=c.$activeOption.outerHeight(!0),n=c.$dropdown_content.scrollTop()||0,a=s=c.$activeOption.offset().top-c.$dropdown_content.offset().top+n,l=s-o+r,s+r>o+n?c.$dropdown_content.stop().animate({scrollTop:l},i?c.settings.scrollDuration:0):s<n&&c.$dropdown_content.stop().animate({scrollTop:a},i?c.settings.scrollDuration:0)))},selectAll:function(){var t=this;"single"!==t.settings.mode&&(t.$activeItems=Array.prototype.slice.apply(t.$control.children(":not(input)").addClass("active")),t.$activeItems.length&&(t.hideInput(),t.close()),t.focus())},hideInput:function(){this.setTextboxValue(""),this.$control_input.css({opacity:0,position:"absolute",left:this.rtl?1e4:-1e4}),this.isInputHidden=!0},showInput:function(){this.$control_input.css({opacity:1,position:"relative",left:0}),this.isInputHidden=!1},focus:function(){var t=this;t.isDisabled||(t.ignoreFocus=!0,t.$control_input[0].focus(),window.setTimeout(function(){t.ignoreFocus=!1,t.onFocus()},0))},blur:function(t){this.$control_input[0].blur(),this.onBlur(null,t)},getScoreFunction:function(t){return this.sifter.getScoreFunction(t,this.getSearchOptions())},getSearchOptions:function(){var t=this.settings,e=t.sortField;return"string"==typeof e&&(e=[{field:e}]),{fields:t.searchField,conjunction:t.searchConjunction,sort:e}},search:function(e){var n,i,o,r=this,s=r.settings,a=this.getSearchOptions();if(s.score&&"function"!=typeof(o=r.settings.score.apply(this,[e])))throw new Error('Selectize "score" setting must be a function that returns a function');if(e!==r.lastQuery?(r.lastQuery=e,i=r.sifter.search(e,t.extend(a,{score:o})),r.currentResults=i):i=t.extend(!0,{},r.currentResults),s.hideSelected)for(n=i.items.length-1;n>=0;n--)-1!==r.items.indexOf(c(i.items[n].id))&&i.items.splice(n,1);return i},refreshOptions:function(e){var n,o,r,s,a,l,p,u,d,h,g,f,v,m,y,w;void 0===e&&(e=!0);var C,b,O=this,$=t.trim(O.$control_input.val()),_=O.search($),k=O.$dropdown_content,x=O.$activeOption&&c(O.$activeOption.attr("data-value"));for(s=_.items.length,"number"==typeof O.settings.maxOptions&&(s=Math.min(s,O.settings.maxOptions)),a={},l=[],n=0;n<s;n++)for(p=O.options[_.items[n].id],u=O.render("option",p),d=p[O.settings.optgroupField]||"",o=0,r=(h=t.isArray(d)?d:[d])&&h.length;o<r;o++)d=h[o],O.optgroups.hasOwnProperty(d)||(d=""),a.hasOwnProperty(d)||(a[d]=document.createDocumentFragment(),l.push(d)),a[d].appendChild(u);for(this.settings.lockOptgroupOrder&&l.sort(function(t,e){return(O.optgroups[t].$order||0)-(O.optgroups[e].$order||0)}),g=document.createDocumentFragment(),n=0,s=l.length;n<s;n++)d=l[n],O.optgroups.hasOwnProperty(d)&&a[d].childNodes.length?((f=document.createDocumentFragment()).appendChild(O.render("optgroup_header",O.optgroups[d])),f.appendChild(a[d]),g.appendChild(O.render("optgroup",t.extend({},O.optgroups[d],{html:(C=f,b=void 0,b=document.createElement("div"),b.appendChild(C.cloneNode(!0)),b.innerHTML),dom:f})))):g.appendChild(a[d]);if(k.html(g),O.settings.highlight&&_.query.length&&_.tokens.length)for(n=0,s=_.tokens.length;n<s;n++)i(k,_.tokens[n].regex);if(!O.settings.hideSelected)for(n=0,s=O.items.length;n<s;n++)O.getOption(O.items[n]).addClass("selected");(v=O.canCreate($))&&(k.prepend(O.render("option_create",{input:$})),w=t(k[0].childNodes[0])),O.hasOptions=_.items.length>0||v,O.hasOptions?(_.items.length>0?((y=x&&O.getOption(x))&&y.length?m=y:"single"===O.settings.mode&&O.items.length&&(m=O.getOption(O.items[0])),m&&m.length||(m=w&&!O.settings.addPrecedence?O.getAdjacentOption(w,1):k.find("[data-selectable]:first"))):m=w,O.setActiveOption(m),e&&!O.isOpen&&O.open()):(O.setActiveOption(null),e&&O.isOpen&&O.close())},addOption:function(e){var n,i,o,r=this;if(t.isArray(e))for(n=0,i=e.length;n<i;n++)r.addOption(e[n]);else(o=r.registerOption(e))&&(r.userOptions[o]=!0,r.lastQuery=null,r.trigger("option_add",o,e))},registerOption:function(t){var e=c(t[this.settings.valueField]);return!(!e||this.options.hasOwnProperty(e))&&(t.$order=t.$order||++this.order,this.options[e]=t,e)},registerOptionGroup:function(t){var e=c(t[this.settings.optgroupValueField]);return!!e&&(t.$order=t.$order||++this.order,this.optgroups[e]=t,e)},addOptionGroup:function(t,e){e[this.settings.optgroupValueField]=t,(t=this.registerOptionGroup(e))&&this.trigger("optgroup_add",t,e)},removeOptionGroup:function(t){this.optgroups.hasOwnProperty(t)&&(delete this.optgroups[t],this.renderCache={},this.trigger("optgroup_remove",t))},clearOptionGroups:function(){this.optgroups={},this.renderCache={},this.trigger("optgroup_clear")},updateOption:function(e,n){var i,o,r,s,a,l,p,u=this;if(e=c(e),r=c(n[u.settings.valueField]),null!==e&&u.options.hasOwnProperty(e)){if("string"!=typeof r)throw new Error("Value must be set in option data");p=u.options[e].$order,r!==e&&(delete u.options[e],-1!==(s=u.items.indexOf(e))&&u.items.splice(s,1,r)),n.$order=n.$order||p,u.options[r]=n,a=u.renderCache.item,l=u.renderCache.option,a&&(delete a[e],delete a[r]),l&&(delete l[e],delete l[r]),-1!==u.items.indexOf(r)&&(i=u.getItem(e),o=t(u.render("item",n)),i.hasClass("active")&&o.addClass("active"),i.replaceWith(o)),u.lastQuery=null,u.isOpen&&u.refreshOptions(!1)}},removeOption:function(t,e){var n=this;t=c(t);var i=n.renderCache.item,o=n.renderCache.option;i&&delete i[t],o&&delete o[t],delete n.userOptions[t],delete n.options[t],n.lastQuery=null,n.trigger("option_remove",t),n.removeItem(t,e)},clearOptions:function(){var t=this;t.loadedSearches={},t.userOptions={},t.renderCache={},t.options=t.sifter.items={},t.lastQuery=null,t.trigger("option_clear"),t.clear()},getOption:function(t){return this.getElementWithValue(t,this.$dropdown_content.find("[data-selectable]"))},getAdjacentOption:function(e,n){var i=this.$dropdown.find("[data-selectable]"),o=i.index(e)+n;return o>=0&&o<i.length?i.eq(o):t()},getElementWithValue:function(e,n){if(void 0!==(e=c(e))&&null!==e)for(var i=0,o=n.length;i<o;i++)if(n[i].getAttribute("data-value")===e)return t(n[i]);return t()},getItem:function(t){return this.getElementWithValue(t,this.$control.children())},addItems:function(e,n){for(var i=t.isArray(e)?e:[e],o=0,r=i.length;o<r;o++)this.isPending=o<r-1,this.addItem(i[o],n)},addItem:function(e,n){h(this,n?[]:["change"],function(){var i,o,r,s,a,l=this,p=l.settings.mode;e=c(e),-1===l.items.indexOf(e)?l.options.hasOwnProperty(e)&&("single"===p&&l.clear(n),"multi"===p&&l.isFull()||(i=t(l.render("item",l.options[e])),a=l.isFull(),l.items.splice(l.caretPos,0,e),l.insertAtCaret(i),(!l.isPending||!a&&l.isFull())&&l.refreshState(),l.isSetup&&(r=l.$dropdown_content.find("[data-selectable]"),l.isPending||(o=l.getOption(e),s=l.getAdjacentOption(o,1).attr("data-value"),l.refreshOptions(l.isFocused&&"single"!==p),s&&l.setActiveOption(l.getOption(s))),!r.length||l.isFull()?l.close():l.positionDropdown(),l.updatePlaceholder(),l.trigger("item_add",e,i),l.updateOriginalInput({silent:n})))):"single"===p&&l.close()})},removeItem:function(t,e){var n,i,o,r=this;n="object"==typeof t?t:r.getItem(t),t=c(n.attr("data-value")),-1!==(i=r.items.indexOf(t))&&(n.remove(),n.hasClass("active")&&(o=r.$activeItems.indexOf(n[0]),r.$activeItems.splice(o,1)),r.items.splice(i,1),r.lastQuery=null,!r.settings.persist&&r.userOptions.hasOwnProperty(t)&&r.removeOption(t,e),i<r.caretPos&&r.setCaret(r.caretPos-1),r.refreshState(),r.updatePlaceholder(),r.updateOriginalInput({silent:e}),r.positionDropdown(),r.trigger("item_remove",t,n))},createItem:function(e,n){var i=this,o=i.caretPos;e=e||t.trim(i.$control_input.val()||"");var r=arguments[arguments.length-1];if("function"!=typeof r&&(r=function(){}),"boolean"!=typeof n&&(n=!0),!i.canCreate(e))return r(),!1;i.lock();var s,a,l="function"==typeof i.settings.create?this.settings.create:function(t){var e={};return e[i.settings.labelField]=t,e[i.settings.valueField]=t,e},p=(s=function(t){if(i.unlock(),!t||"object"!=typeof t)return r();var e=c(t[i.settings.valueField]);if("string"!=typeof e)return r();i.setTextboxValue(""),i.addOption(t),i.setCaret(o),i.addItem(e),i.refreshOptions(n&&"single"!==i.settings.mode),r(t)},a=!1,function(){a||(a=!0,s.apply(this,arguments))}),u=l.apply(this,[e,p]);return void 0!==u&&p(u),!0},refreshItems:function(){this.lastQuery=null,this.isSetup&&this.addItem(this.items),this.refreshState(),this.updateOriginalInput()},refreshState:function(){var t=this;t.isRequired&&(t.items.length&&(t.isInvalid=!1),t.$control_input.prop("required",void 0)),t.refreshClasses()},refreshClasses:function(){var e=this,n=e.isFull(),i=e.isLocked;e.$wrapper.toggleClass("rtl",e.rtl),e.$control.toggleClass("focus",e.isFocused).toggleClass("disabled",e.isDisabled).toggleClass("required",e.isRequired).toggleClass("invalid",e.isInvalid).toggleClass("locked",i).toggleClass("full",n).toggleClass("not-full",!n).toggleClass("input-active",e.isFocused&&!e.isInputHidden).toggleClass("dropdown-active",e.isOpen).toggleClass("has-options",!t.isEmptyObject(e.options)).toggleClass("has-items",e.items.length>0),e.$control_input.data("grow",!n&&!i)},isFull:function(){return null!==this.settings.maxItems&&this.items.length>=this.settings.maxItems},updateOriginalInput:function(t){var e,n,i,o,r=this;if(t=t||{},1===r.tagType){for(i=[],e=0,n=r.items.length;e<n;e++)o=r.options[r.items[e]][r.settings.labelField]||"",i.push('<option value="'+u(r.items[e])+'" selected="selected">'+u(o)+"</option>");i.length||this.$input.attr("multiple")||i.push('<option value="" selected="selected"></option>'),r.$input.html(i.join(""))}else r.$input.val(r.getValue()),r.$input.attr("value",r.$input.val());r.isSetup&&(t.silent||r.trigger("change",r.$input.val()))},updatePlaceholder:function(){if(this.settings.placeholder){var t=this.$control_input;this.items.length?t.removeAttr("placeholder"):t.attr("placeholder",this.settings.placeholder),t.triggerHandler("update",{force:!0})}},open:function(){var t=this;t.isLocked||t.isOpen||"multi"===t.settings.mode&&t.isFull()||(t.focus(),t.isOpen=!0,t.refreshState(),t.$dropdown.css({visibility:"hidden",display:"block"}),t.positionDropdown(),t.$dropdown.css({visibility:"visible"}),t.trigger("dropdown_open",t.$dropdown))},close:function(){var t=this,e=t.isOpen;"single"===t.settings.mode&&t.items.length&&t.hideInput(),t.isOpen=!1,t.$dropdown.hide(),t.setActiveOption(null),t.refreshState(),e&&t.trigger("dropdown_close",t.$dropdown)},positionDropdown:function(){var t=this.$control,e="body"===this.settings.dropdownParent?t.offset():t.position();e.top+=t.outerHeight(!0),this.$dropdown.css({width:t.outerWidth(),top:e.top,left:e.left})},clear:function(t){var e=this;e.items.length&&(e.$control.children(":not(input)").remove(),e.items=[],e.lastQuery=null,e.setCaret(0),e.setActiveItem(null),e.updatePlaceholder(),e.updateOriginalInput({silent:t}),e.refreshState(),e.showInput(),e.trigger("clear"))},insertAtCaret:function(e){var n=Math.min(this.caretPos,this.items.length);0===n?this.$control.prepend(e):t(this.$control[0].childNodes[n]).before(e),this.setCaret(n+1)},deleteSelection:function(e){var n,i,o,r,s,a,l,p,c,u=this;if(o=e&&8===e.keyCode?-1:1,r=g(u.$control_input[0]),u.$activeOption&&!u.settings.hideSelected&&(l=u.getAdjacentOption(u.$activeOption,-1).attr("data-value")),s=[],u.$activeItems.length){for(c=u.$control.children(".active:"+(o>0?"last":"first")),a=u.$control.children(":not(input)").index(c),o>0&&a++,n=0,i=u.$activeItems.length;n<i;n++)s.push(t(u.$activeItems[n]).attr("data-value"));e&&(e.preventDefault(),e.stopPropagation())}else(u.isFocused||"single"===u.settings.mode)&&u.items.length&&(o<0&&0===r.start&&0===r.length?s.push(u.items[u.caretPos-1]):o>0&&r.start===u.$control_input.val().length&&s.push(u.items[u.caretPos]));if(!s.length||"function"==typeof u.settings.onDelete&&!1===u.settings.onDelete.apply(u,[s]))return!1;for(void 0!==a&&u.setCaret(a);s.length;)u.removeItem(s.pop());return u.showInput(),u.positionDropdown(),u.refreshOptions(!0),l&&(p=u.getOption(l)).length&&u.setActiveOption(p),!0},advanceSelection:function(t,e){var n,i,o,r,s,a=this;0!==t&&(a.rtl&&(t*=-1),n=t>0?"last":"first",i=g(a.$control_input[0]),a.isFocused&&!a.isInputHidden?(r=a.$control_input.val().length,(t<0?0===i.start&&0===i.length:i.start===r)&&!r&&a.advanceCaret(t,e)):(s=a.$control.children(".active:"+n)).length&&(o=a.$control.children(":not(input)").index(s),a.setActiveItem(null),a.setCaret(t>0?o+1:o)))},advanceCaret:function(t,e){var n,i,o=this;0!==t&&(n=t>0?"next":"prev",o.isShiftDown?(i=o.$control_input[n]()).length&&(o.hideInput(),o.setActiveItem(i),e&&e.preventDefault()):o.setCaret(o.caretPos+t))},setCaret:function(e){var n,i,o,r,s=this;if(e="single"===s.settings.mode?s.items.length:Math.max(0,Math.min(s.items.length,e)),!s.isPending)for(n=0,i=(o=s.$control.children(":not(input)")).length;n<i;n++)r=t(o[n]).detach(),n<e?s.$control_input.before(r):s.$control.append(r);s.caretPos=e},lock:function(){this.close(),this.isLocked=!0,this.refreshState()},unlock:function(){this.isLocked=!1,this.refreshState()},disable:function(){this.$input.prop("disabled",!0),this.$control_input.prop("disabled",!0).prop("tabindex",-1),this.isDisabled=!0,this.lock()},enable:function(){var t=this;t.$input.prop("disabled",!1),t.$control_input.prop("disabled",!1).prop("tabindex",t.tabIndex),t.isDisabled=!1,t.unlock()},destroy:function(){var e=this,n=e.eventNS,i=e.revertSettings;e.trigger("destroy"),e.off(),e.$wrapper.remove(),e.$dropdown.remove(),e.$input.html("").append(i.$children).removeAttr("tabindex").removeClass("selectized").attr({tabindex:i.tabindex}).show(),e.$control_input.removeData("grow"),e.$input.removeData("selectize"),t(window).off(n),t(document).off(n),t(document.body).off(n),delete e.$input[0].selectize},render:function(e,n){var i,o,r="",s=!1,a=this;return"option"!==e&&"item"!==e||(s=!!(i=c(n[a.settings.valueField]))),s&&(p(a.renderCache[e])||(a.renderCache[e]={}),a.renderCache[e].hasOwnProperty(i))?a.renderCache[e][i]:(r=t(a.settings.render[e].apply(this,[n,u])),"option"===e||"option_create"===e?r.attr("data-selectable",""):"optgroup"===e&&(o=n[a.settings.optgroupValueField]||"",r.attr("data-group",o)),"option"!==e&&"item"!==e||r.attr("data-value",i||""),s&&(a.renderCache[e][i]=r[0]),r[0])},clearCache:function(t){void 0===t?this.renderCache={}:delete this.renderCache[t]},canCreate:function(t){if(!this.settings.create)return!1;var e=this.settings.createFilter;return t.length&&("function"!=typeof e||e.apply(this,[t]))&&("string"!=typeof e||new RegExp(e).test(t))&&(!(e instanceof RegExp)||e.test(t))}}),v.count=0,v.defaults={options:[],optgroups:[],plugins:[],delimiter:",",splitOn:null,persist:!0,diacritics:!0,create:!1,createOnBlur:!1,createFilter:null,highlight:!0,openOnFocus:!0,maxOptions:1e3,maxItems:null,hideSelected:null,addPrecedence:!1,selectOnTab:!1,preload:!1,allowEmptyOption:!1,closeAfterSelect:!1,scrollDuration:60,loadThrottle:300,loadingClass:"loading",dataAttr:"data-data",optgroupField:"optgroup",valueField:"value",labelField:"text",optgroupLabelField:"label",optgroupValueField:"value",lockOptgroupOrder:!1,sortField:"$order",searchField:["text"],searchConjunction:"and",mode:null,wrapperClass:"selectize-control",inputClass:"selectize-input",dropdownClass:"selectize-dropdown",dropdownContentClass:"selectize-dropdown-content",dropdownParent:null,copyClassesToDropdown:!0,render:{}},t.fn.selectize=function(e){var n=t.fn.selectize.defaults,i=t.extend({},n,e),o=i.dataAttr,r=i.labelField,s=i.valueField,a=i.optgroupField,l=i.optgroupLabelField,p=i.optgroupValueField;return this.each(function(){if(!this.selectize){var u=t(this),d=this.tagName.toLowerCase(),h=u.attr("placeholder")||u.attr("data-placeholder");h||i.allowEmptyOption||(h=u.children('option[value=""]').text());var g={placeholder:h,options:[],optgroups:[],items:[]};"select"===d?function(e,n){var u,d,h,g,f=n.options,v={},m=function(t){var e=o&&t.attr(o);return"string"==typeof e&&e.length?JSON.parse(e):null},y=function(e,o){e=t(e);var l=c(e.attr("value"));if(l||i.allowEmptyOption)if(v.hasOwnProperty(l)){if(o){var p=v[l][a];p?t.isArray(p)?p.push(o):v[l][a]=[p,o]:v[l][a]=o}}else{var u=m(e)||{};u[r]=u[r]||e.text(),u[s]=u[s]||l,u[a]=u[a]||o,v[l]=u,f.push(u),e.is(":selected")&&n.items.push(l)}},w=function(e){var i,o,r,s,a;for((r=(e=t(e)).attr("label"))&&((s=m(e)||{})[l]=r,s[p]=r,n.optgroups.push(s)),i=0,o=(a=t("option",e)).length;i<o;i++)y(a[i],r)};for(n.maxItems=e.attr("multiple")?null:1,u=0,d=(g=e.children()).length;u<d;u++)"optgroup"===(h=g[u].tagName.toLowerCase())?w(g[u]):"option"===h&&y(g[u])}(u,g):function(e,n){var a,l,p,c,u=e.attr(o);if(u)for(n.options=JSON.parse(u),a=0,l=n.options.length;a<l;a++)n.items.push(n.options[a][s]);else{var d=t.trim(e.val()||"");if(!i.allowEmptyOption&&!d.length)return;for(a=0,l=(p=d.split(i.delimiter)).length;a<l;a++)(c={})[r]=p[a],c[s]=p[a],n.options.push(c);n.items=p}}(u,g),new v(u,t.extend(!0,{},n,g,e))}})},t.fn.selectize.defaults=v.defaults,t.fn.selectize.support={validity:l},v.define("drag_drop",function(e){if(!t.fn.sortable)throw new Error('The "drag_drop" plugin requires jQuery UI "sortable".');if("multi"===this.settings.mode){var n,i,o,r=this;r.lock=(n=r.lock,function(){var t=r.$control.data("sortable");return t&&t.disable(),n.apply(r,arguments)}),r.unlock=(i=r.unlock,function(){var t=r.$control.data("sortable");return t&&t.enable(),i.apply(r,arguments)}),r.setup=(o=r.setup,function(){o.apply(this,arguments);var e=r.$control.sortable({items:"[data-value]",forcePlaceholderSize:!0,disabled:r.isLocked,start:function(t,n){n.placeholder.css("width",n.helper.css("width")),e.css({overflow:"visible"})},stop:function(){e.css({overflow:"hidden"});var n=r.$activeItems?r.$activeItems.slice():null,i=[];e.children("[data-value]").each(function(){i.push(t(this).attr("data-value"))}),r.setValue(i),r.setActiveItem(n)}})})}}),v.define("dropdown_header",function(e){var n,i=this;e=t.extend({title:"Untitled",headerClass:"selectize-dropdown-header",titleRowClass:"selectize-dropdown-header-title",labelClass:"selectize-dropdown-header-label",closeClass:"selectize-dropdown-header-close",html:function(t){return'<div class="'+t.headerClass+'"><div class="'+t.titleRowClass+'"><span class="'+t.labelClass+'">'+t.title+'</span><a href="javascript:void(0)" class="'+t.closeClass+'">&times;</a></div></div>'}},e),i.setup=(n=i.setup,function(){n.apply(i,arguments),i.$dropdown_header=t(e.html(e)),i.$dropdown.prepend(i.$dropdown_header)})}),v.define("optgroup_columns",function(e){var n,i=this;e=t.extend({equalizeWidth:!0,equalizeHeight:!0},e),this.getAdjacentOption=function(e,n){var i=e.closest("[data-group]").find("[data-selectable]"),o=i.index(e)+n;return o>=0&&o<i.length?i.eq(o):t()},this.onKeyDown=(n=i.onKeyDown,function(t){var e,o,r,s;return!this.isOpen||37!==t.keyCode&&39!==t.keyCode?n.apply(this,arguments):(i.ignoreHover=!0,e=(s=this.$activeOption.closest("[data-group]")).find("[data-selectable]").index(this.$activeOption),void((o=(r=(s=37===t.keyCode?s.prev("[data-group]"):s.next("[data-group]")).find("[data-selectable]")).eq(Math.min(r.length-1,e))).length&&this.setActiveOption(o)))});var o=function(){var t,e=o.width,n=document;return void 0===e&&((t=n.createElement("div")).innerHTML='<div style="width:50px;height:50px;position:absolute;left:-50px;top:-50px;overflow:auto;"><div style="width:1px;height:100px;"></div></div>',t=t.firstChild,n.body.appendChild(t),e=o.width=t.offsetWidth-t.clientWidth,n.body.removeChild(t)),e},r=function(){var n,r,s,a,l,p,c;if((r=(c=t("[data-group]",i.$dropdown_content)).length)&&i.$dropdown_content.width()){if(e.equalizeHeight){for(s=0,n=0;n<r;n++)s=Math.max(s,c.eq(n).height());c.css({height:s})}e.equalizeWidth&&(p=i.$dropdown_content.innerWidth()-o(),a=Math.round(p/r),c.css({width:a}),r>1&&(l=p-a*(r-1),c.eq(r-1).css({width:l})))}};(e.equalizeHeight||e.equalizeWidth)&&(d.after(this,"positionDropdown",r),d.after(this,"refreshOptions",r))}),v.define("remove_button",function(e){e=t.extend({label:"&times;",title:"Remove",className:"remove",append:!0},e);var n,i,o,r,s;"single"!==this.settings.mode?(r=n=this,s='<a href="javascript:void(0)" class="'+(i=e).className+'" tabindex="-1" title="'+u(i.title)+'">'+i.label+"</a>",n.setup=(o=r.setup,function(){if(i.append){var e=r.settings.render.item;r.settings.render.item=function(t){return i=e.apply(n,arguments),o=s,r=i.search(/(<\/[^>]+>\s*)$/),i.substring(0,r)+o+i.substring(r);var i,o,r}}o.apply(n,arguments),n.$control.on("click","."+i.className,function(e){if(e.preventDefault(),!r.isLocked){var n=t(e.currentTarget).parent();r.setActiveItem(n),r.deleteSelection()&&r.setCaret(r.items.length)}})})):function(e,n){n.className="remove-single";var i,o=e,r='<a href="javascript:void(0)" class="'+n.className+'" tabindex="-1" title="'+u(n.title)+'">'+n.label+"</a>";e.setup=(i=o.setup,function(){if(n.append){var s=t(o.$input.context).attr("id"),a=(t("#"+s),o.settings.render.item);o.settings.render.item=function(t){return a.apply(e,arguments)+r}}i.apply(e,arguments),e.$control.on("click","."+n.className,function(t){t.preventDefault(),o.isLocked||o.clear()})})}(this,e)}),v.define("restore_on_backspace",function(t){var e,n=this;t.text=t.text||function(t){return t[this.settings.labelField]},this.onKeyDown=(e=n.onKeyDown,function(n){var i,o;return 8===n.keyCode&&""===this.$control_input.val()&&!this.$activeItems.length&&(i=this.caretPos-1)>=0&&i<this.items.length?(o=this.options[this.items[i]],this.deleteSelection(n)&&(this.setTextboxValue(t.text.apply(this,[o])),this.refreshOptions(!0)),void n.preventDefault()):e.apply(this,arguments)})}),v}),function(t){var e="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAIAAAHnlligAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAHJJREFUeNpi+P///4EDBxiAGMgCCCAGFB5AADGCRBgYDh48CCRZIJS9vT2QBAggFBkmBiSAogxFBiCAoHogAKIKAlBUYTELAiAmEtABEECk20G6BOmuIl0CIMBQ/IEMkO0myiSSraaaBhZcbkUOs0HuBwDplz5uFJ3Z4gAAAABJRU5ErkJggg==",n=wp.i18n.__;Color.fn.toString=function(){if(this._alpha<1)return this.toCSS("rgba",this._alpha).replace(/\s+/g,"");var t=parseInt(this._color,10).toString(16);if(this.error)return"";if(t.length<6)for(var e=6-t.length-1;e>=0;e--)t="0"+t;return"#"+t},t.widget("wp.wpColorPicker",t.wp.wpColorPicker,{_create:function(){if(t.support.iris){var i=this,o=i.element;t.extend(i.options,o.data()),i.close=t.proxy(i.close,i),i.initialValue=o.val(),o.addClass("wp-color-picker").hide().wrap('<div class="wp-picker-container" />'),i.wrap=o.parent(),i.toggler=t('<a tabindex="0" class="wp-color-result" />').insertBefore(o).css({backgroundColor:i.initialValue}).attr("title",n("Select Color")).attr("data-current",n("Current Color")),i.pickerContainer=t('<div class="wp-picker-holder" />').insertAfter(o),i.button=t('<input type="button" class="button button-small hidden" />'),i.options.defaultColor?i.button.addClass("wp-picker-default").val(n("Default")):i.button.addClass("wp-picker-clear").val(n("Clear")),o.wrap('<span class="wp-picker-input-wrap" />').after(i.button),i.inputWrapper=o.closest(".wp-picker-input-wrap"),o.iris({target:i.pickerContainer,hide:i.options.hide,width:i.options.width,mode:i.options.mode,palettes:i.options.palettes,change:function(n,o){i.options.alpha?(i.toggler.css({"background-image":"url("+e+")"}).html("<span />"),i.toggler.find("span").css({width:"100%",height:"100%",position:"absolute",top:0,left:0,"border-top-left-radius":"3px","border-bottom-left-radius":"3px",background:o.color.toString()})):i.toggler.css({backgroundColor:o.color.toString()}),t.isFunction(i.options.change)&&i.options.change.call(this,n,o)}}),o.val(i.initialValue),i._addListeners(),i.options.hide||i.toggler.click()}},_addListeners:function(){var e=this;e.wrap.on("click.wpcolorpicker",function(t){t.stopPropagation()}),e.toggler.click(function(){e.toggler.hasClass("wp-picker-open")?e.close():e.open()}),e.element.change(function(n){(""===t(this).val()||e.element.hasClass("iris-error"))&&(e.options.alpha?(e.toggler.removeAttr("style"),e.toggler.find("span").css("backgroundColor","")):e.toggler.css("backgroundColor",""),t.isFunction(e.options.clear)&&e.options.clear.call(this,n))}),e.toggler.on("keyup",function(t){13!==t.keyCode&&32!==t.keyCode||(t.preventDefault(),e.toggler.trigger("click").next().focus())}),e.button.click(function(n){var i=t(this);i.hasClass("wp-picker-clear")?(e.element.val(""),e.options.alpha?(e.toggler.removeAttr("style"),e.toggler.find("span").css("backgroundColor","")):e.toggler.css("backgroundColor",""),t.isFunction(e.options.clear)&&e.options.clear.call(this,n)):i.hasClass("wp-picker-default")&&e.element.val(e.options.defaultColor).change()})}}),t.widget("a8c.iris",t.a8c.iris,{_create:function(){if(this._super(),this.options.alpha=this.element.data("alpha")||!1,this.element.is(":input")||(this.options.alpha=!1),void 0!==this.options.alpha&&this.options.alpha){var e=this,n=e.element,i=t('<div class="iris-strip iris-slider iris-alpha-slider"><div class="iris-slider-offset iris-slider-offset-alpha"></div></div>').appendTo(e.picker.find(".iris-picker-inner")),o={aContainer:i,aSlider:i.find(".iris-slider-offset-alpha")};void 0!==n.data("custom-width")?e.options.customWidth=parseInt(n.data("custom-width"))||0:e.options.customWidth=100,e.options.defaultWidth=n.width(),(e._color._alpha<1||1!=e._color.toString().indexOf("rgb"))&&n.width(parseInt(e.options.defaultWidth+e.options.customWidth)),t.each(o,function(t,n){e.controls[t]=n}),e.controls.square.css({"margin-right":"0"});var r=e.picker.width()-e.controls.square.width()-20,s=r/6,a=r/2-s;t.each(["aContainer","strip"],function(t,n){e.controls[n].width(a).css({"margin-left":s+"px"})}),e._initControls(),e._change()}},_initControls:function(){if(this._super(),this.options.alpha){var t=this;t.controls.aSlider.slider({orientation:"vertical",min:0,max:100,step:1,value:parseInt(100*t._color._alpha),slide:function(e,n){t._color._alpha=parseFloat(n.value/100),t._change.apply(t,arguments)}})}},_change:function(){this._super();var t=this,n=t.element;if(this.options.alpha){var i=t.controls,o=parseInt(100*t._color._alpha),r=t._color.toRgb(),s=["rgb("+r.r+","+r.g+","+r.b+") 0%","rgba("+r.r+","+r.g+","+r.b+", 0) 100%"],a=t.options.defaultWidth,l=t.options.customWidth,p=t.picker.closest(".wp-picker-container").find(".wp-color-result");if(i.aContainer.css({background:"linear-gradient(to bottom, "+s.join(", ")+"), url("+e+")"}),p.hasClass("wp-picker-open"))if(i.aSlider.slider("value",o),t._color._alpha<1){var c=i.strip.attr("style").replace(/rgba\(([0-9]+,)(\s+)?([0-9]+,)(\s+)?([0-9]+)(,(\s+)?[0-9\.]+)\)/g,"rgb($1$3$5)");i.strip.attr("style",c),n.width(parseInt(a+l))}else n.width(a)}(n.data("reset-alpha")||!1)&&t.picker.find(".iris-palette-container").on("click.palette",".iris-palette",function(){t._color._alpha=1,t.active="external",t._change()})},_addInputListeners:function(t){var e=this,n=function(n){var i=new Color(t.val()),o=t.val();t.removeClass("iris-error"),i.error?""!==o&&t.addClass("iris-error"):i.toString()!==e._color.toString()&&("keyup"===n.type&&o.match(/^[0-9a-fA-F]{3}$/)||e._setOption("color",i.toString()))};t.on("change",n).on("keyup",e._debounce(n,100)),e.options.hide&&t.one("focus",function(){e.show()})}})}(jQuery),jQuery(document).ready(function(t){t(".color-picker").wpColorPicker()});
 